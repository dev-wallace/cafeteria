<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Novo Produto — Cafeteria</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Icons (opcional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Estilos específicos da página (pode mover para /static/css/site.css) -->
  <style>
    :root{
      --primary: #00704A;    /* verde principal */
      --primary-dark: #006241;
      --accent: #20c997;
      --bg: #F9F5F0;
      --card: #ffffff;
      --muted: #5a5a5a;
      --radius: 12px;
    }

    body {
      background: linear-gradient(180deg, var(--bg), #ffffff 200px);
      font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      color: #2f2f2f;
    }

    /* Classe reutilizável para formulários administrativos */
    .admin-product-form {
      max-width: 980px;
      margin: 28px auto;
      padding: 20px;
    }

    .card-form {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 8px 28px rgba(2, 40, 20, 0.06);
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.03);
    }

    .card-form .card-header {
      background: linear-gradient(90deg, rgba(0,112,74,0.95), rgba(0,98,61,0.95));
      color: white;
      padding: 18px 22px;
      font-weight: 700;
      font-size: 1.05rem;
    }

    .card-body {
      padding: 20px;
    }

    .form-label {
      font-weight: 600;
      color: #333;
    }

    /* Inputs custom */
    .form-control-custom {
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.08);
      padding: 10px 12px;
      transition: box-shadow 0.16s, border-color 0.16s;
      background: #fff;
    }
    .form-control-custom:focus {
      outline: none;
      box-shadow: 0 6px 18px rgba(0,112,74,0.08);
      border-color: var(--primary);
    }

    /* File input custom (wrapper) */
    .file-input-wrap {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .btn-file {
      background: linear-gradient(180deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform .12s ease;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .btn-file:hover { transform: translateY(-3px); }

    .img-preview {
      width: 92px;
      height: 92px;
      border-radius: 8px;
      background: #f3f3f3;
      border: 1px dashed rgba(0,0,0,0.06);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .img-preview img { width:100%; height:100%; object-fit:cover; }

    /* Actions */
    .actions {
      display:flex;
      gap:12px;
      align-items:center;
      margin-top: 12px;
    }
    .btn-primary-custom {
      background: linear-gradient(180deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,112,74,0.12);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn-primary-custom:hover { transform: translateY(-3px); box-shadow: 0 10px 26px rgba(0,112,74,0.14); }

    .btn-cancel {
      background: transparent;
      border: 1px solid rgba(0,0,0,0.08);
      color: var(--muted);
      padding: 8px 14px;
      border-radius: 10px;
    }

    /* Pequenas notas e ajuda */
    .form-help {
      font-size: 0.88rem;
      color: #6b6b6b;
    }

    /* Responsividade */
    @media (max-width: 768px){
      .img-preview { width: 76px; height: 76px; }
      .admin-product-form { padding: 10px; }
    }
  </style>
</head>
<body>
    <div th:replace="~{fragments/header}"></div>


  <main class="admin-product-form">
    <div class="card card-form">
      <div class="card-header">
        Cadastrar Novo Produto
      </div>

      <div class="card-body">
        <form th:action="@{/admin/produtos/novo}" method="post" enctype="multipart/form-data" id="productForm">
          <div class="row g-3">
            <div class="col-lg-6">
              <label for="nome" class="form-label">Nome do Produto <span class="text-danger">*</span></label>
              <input type="text" id="nome" name="nome" class="form-control form-control-custom" required>

              <label for="preco" class="form-label mt-3">Preço (R$) <span class="text-danger">*</span></label>
              <input type="number" step="0.01" id="preco" name="preco" class="form-control form-control-custom" required placeholder="Ex: 9.90">

              <label for="categoria" class="form-label mt-3">Categoria</label>
              <select id="categoria" name="categoria" class="form-select form-control-custom">
                <option value="">-- selecione --</option>
                <option>Café</option>
                <option>Chá</option>
                <option>Bolos</option>
                <option>Sanduíches</option>
                <option>Sucos</option>
              </select>

              <div class="form-help mt-2">Campos com <span class="text-danger">*</span> são obrigatórios.</div>
            </div>

            <div class="col-lg-6">
              <label class="form-label">Imagem do Produto</label>
              <div class="file-input-wrap mt-1">
                <div class="img-preview" id="imgPreview">
                  <i class="bi bi-image" style="font-size:1.4rem; color:rgba(0,0,0,0.18)"></i>
                </div>

                <div style="flex:1; min-width:160px;">
                  <!-- input file estilizado: esconder input real e usar label/button -->
                  <label class="btn-file" for="imagemInput">
                    <i class="bi bi-upload"></i>
                    Selecionar imagem
                  </label>
                  <input id="imagemInput" name="imagem" type="file" accept="image/*" style="display:none;">
                  <div class="form-help mt-2">Formato JPEG/PNG. Máx. recomendado 2MB.</div>
                </div>
              </div>

              <label for="descricao" class="form-label mt-3">Descrição</label>
              <textarea id="descricao" name="descricao" rows="6" class="form-control form-control-custom" placeholder="Ex: Delicioso café com leite e espuma..."></textarea>
            </div>
          </div>

          <div class="actions mt-4">
            <button type="submit" class="btn btn-primary-custom">Salvar Produto</button>
            <a th:href="@{/admin/dashboard}" class="btn btn-cancel">Cancelar</a>
          </div>
        </form>
      </div>
    </div>
  </main>



  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // preview simples da imagem selecionada
    (function(){
      const input = document.getElementById('imagemInput');
      const preview = document.getElementById('imgPreview');

      input && input.addEventListener('change', (e) => {
        const f = e.target.files && e.target.files[0];
        if(!f) {
          preview.innerHTML = '<i class="bi bi-image" style="font-size:1.4rem; color:rgba(0,0,0,0.18)"></i>';
          return;
        }
        const reader = new FileReader();
        reader.onload = function(ev){
          preview.innerHTML = '<img src="' + ev.target.result + '" alt="preview">';
        };
        reader.readAsDataURL(f);
      });
    })();
  </script>
  <div th:replace="~{fragments/footer}"></div>
  <script>
  (function () {
    const precoInput = document.getElementById('preco');
    const form = document.getElementById('productForm');

    if (!precoInput) return;

    // 1) garante atributo min como redundância (pode já estar no HTML)
    precoInput.setAttribute('min', '0');
    precoInput.setAttribute('step', '0.01');

    // 2) bloquear teclas que podem inserir sinal negativo ou expoente
    precoInput.addEventListener('keydown', function (e) {
      // permitir: números, backspace, delete, tab, setas, ponto, vírgula
      const allowedKeys = [
        'Backspace','Delete','Tab','ArrowLeft','ArrowRight','Home','End'
      ];
      const key = e.key;

      // bloquear 'e', 'E', '+', '-' para evitar notações e sinais
      if (key === 'e' || key === 'E' || key === '+' || key === '-') {
        e.preventDefault();
        return;
      }
      // permitir se é tecla de edição/navegação
      if (allowedKeys.indexOf(key) !== -1) return;
      // permitir números e ponto/decimal
      const isNumber = /[0-9]/.test(key);
      const isDecimalSeparator = (key === '.' || key === ',');
      if (!isNumber && !isDecimalSeparator) {
        e.preventDefault();
      }
    });

    // 3) sanitizar input em tempo real (remove caracteres inválidos e impede valor < 0)
    precoInput.addEventListener('input', function () {
      let v = this.value || '';
      // normalize comma to dot
      v = v.replace(',', '.');

      // remove tudo que não número ou ponto
      v = v.replace(/[^0-9.]/g, '');

      // se houver mais de um ponto, mantém só o primeiro
      const parts = v.split('.');
      if (parts.length > 2) {
        v = parts.shift() + '.' + parts.join('');
      }

      // remove zeros à esquerda indesejados (exceto "0." caso decimal)
      if (!v.startsWith('0.')) {
        v = v.replace(/^0+([1-9])/, '$1'); // transforma 0005 -> 5
      }

      // atualiza o campo
      this.value = v;

      // valida numérico e não-negativo
      const num = parseFloat(v);
      if (!isNaN(num) && num < 0) {
        // corrige para 0 (ou limpa, dependendo da preferência)
        this.value = '';
      }
    });

    // 4) valida no submit (última defesa)
    if (form) {
      form.addEventListener('submit', function (e) {
        const val = parseFloat(precoInput.value.replace(',', '.'));
        if (isNaN(val) || val < 0) {
          e.preventDefault();
          precoInput.focus();
          // mensagem simples — você pode substituir por componente inline
          alert('Por favor insira um preço válido (número maior ou igual a 0).');
        }
      });
    }
  })();
</script>

</body>
</html>
